<div class="container mt-3">
  <div class="row">
    <div class="col-12 col-sm-6 col-lg-4" *ngFor="let product of products">
      <div class="card produce-card my-2">
        <img class="card-img-top" src="{{product.picturePath}}" alt="photo of product">
        <div class="card-title">
          <h2 class="card-title mt-2">{{product.name | titlecase}}</h2>
          <div>Selling for R{{product.price}}</div>
        </div>
        <div class="card-body">
          <div class="container row no-gutters pt-3">
            <div class="col-12 col-md-6">
              <button class="btn btn-success btn-lg" (click)="onDetailProductClicked(product)" [disabled]="product.amount === 0 && product.inStock === 0" type="button" data-bs-toggle="modal" data-bs-target="#exampleModal">Buy</button>
            </div>
            <div class="col-12 col-md-6 stock-amount-section">
              <span class="badge text-bg-dark rounded-pill stock-amount-field">{{product.inStock}} in stock</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" *ngIf="productToDetail">
      <div class="modal-header product-detail-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">{{productToDetail.name | titlecase}}</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body product-detail-body">
        <div class="product-detail-info">
          <div>
            Price: R{{productToDetail.price}}
          </div>
          <div >
          Amount available: {{productToDetail.inStock}}
          </div>
        </div>
        <div *ngIf="productToDetail.productSupplierJoins.length > 0">
          <div>
            Suppliers:
          </div>
          <ul>
            <li *ngFor="let productSupplier of productToDetail.productSupplierJoins">{{productSupplier.supplier!.name}}</li>
          </ul>
        </div>
        <div class="no-suppliers" *ngIf="productToDetail.productSupplierJoins.length == 0">
          This product has no suppliers!
        </div>
      </div>
      <div class="modal-footer product-detail-footer" *ngIf="productToDetail.productSupplierJoins.length > 0">
        <button class="btn btn-primary product-buy-button" (click)="onBuyDetailedProductClicked()" [disabled]="productBuyAmount == 0">Add to cart</button>
        <input class="product-buy-input" type="number" [(ngModel)]="productBuyAmount" min="0" oninput="validity.valid||(value='');">
      </div>
    </div>
    <div class="modal-content" *ngIf="!productToDetail">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Product</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="loader"></div>
    </div>
  </div>
</div>